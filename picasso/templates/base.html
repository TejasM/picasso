{% extends 'main_template.html' %}
{% load staticfiles %}<!-- Revolution Slider -->
{% block above_content %}
    <section class="revolution-slider">
        <div class="bannercontainer">
            <div class="banner">
                <ul>
                    <!-- Slide 1 -->
                    <li data-transition="fade" data-slotamount="7" data-masterspeed="1500">
                        <!-- Main Image -->
                        <img src="{% static 'images/musician-349790_1280.jpg' %}"
                             style="opacity:0;" alt="slidebg1"
                             data-bgfit="cover"
                             data-bgposition="left bottom" data-bgrepeat="no-repeat">
                        <!-- Layers -->
                        <!-- Layer 1 -->
                        <div class="caption sft revolution-starhotel bigtext"
                             data-x="505"
                             data-y="30"
                             data-speed="700"
                             data-start="1700"
                             data-easing="easeOutBack">
                            <span><i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                    class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span> Let Picasso help <br> &#09;&#09; find
                            the best hobby <br>&#09;&#09;teachers near you. <span><i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span></div>
                    </li>
                    <!-- Slide 2 -->
                    <li data-transition="boxfade" data-slotamount="7" data-masterspeed="1000">
                        <!-- Main Image -->
                        <img src="http://martialartsmtpleasant.com/files/2011/06/iStock_000016095819_Small.jpg"
                             alt="darkblurbg" data-bgfit="cover"
                             data-bgposition="left top"
                             data-bgrepeat="no-repeat">
                        <!-- Layers -->
                        <!-- Layer 1 -->
                        <div class="caption sft revolution-starhotel bigtext"
                             data-x="400"
                             data-y="100"
                             data-speed="700"
                             data-start="1700"
                             data-easing="easeOutBack">
                        <span><i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span> Great instructors lead
                            <br>to
                            great results <span><i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span></div>
                    </li>
                </ul>
            </div>
        </div>
    </section>
{% endblock %}
{% block scripts %}
    <script>
        function initialize() {
            var mapOptions = {
                zoom: 10,
                center: new google.maps.LatLng(43.7, 79.4)
            };

            var map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    map.setCenter(initialLocation);
                });
            }
            geocoder = new google.maps.Geocoder();
            var json = locations;
            for (var i = 0; i < json.length; i++) {
                if (json[i] != 'None' && json[i]['fields']['postal_code'] != '') {
                    var address = json[i]['fields']['postal_code'] + ' ' + json[i]['fields']['country'];
                    geocoder.geocode({ 'address': address}, function (results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            var marker = new google.maps.Marker({
                                map: map,
                                position: results[0].geometry.location,
                                title: names[0],
                                visible: true
                            });
                            console.log(results[0]);
                        } else {
                            console.log("Geocode was not successful for the following reason: " + status);
                        }
                    });
                }
            }
        }

        function loadScript() {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&' +
                    'callback=initialize';
            document.body.appendChild(script);
        }
        var locations = [];
        var names = [];
        var geocoder = null;

        $(function () {
            var $main = $('#main-section');
            $.get('{% url 'main:featured' %}', function (data) {
                $main.append(data['html']);
                locations = $.parseJSON(data['addresses']);
                names = data['names'];
                loadScript();
                loadFilters();
            });
            $('#search-submisson').click(function (e) {
                $.get('{% url 'main:get_listings' %}', {'term': $('#search-text').val() + ' ' + $('#location-text').val()}, function (data) {
                    $('.revolution-slider').hide();
                    $main.empty();
                    $main.append(data);
                });
                return false;
            });

            $main.on('click', '.detail-back', function () {
                $('.revolution-slider').hide();
                $main.find('> div:last-child').remove();
                $main.find('> section').show();
            });

            $main.on('click', '#review-button', function () {
                {% if user.is_authenticated %}
                    $('#review_form').show();
                    $("#review-rating").rating({'min': 0, 'max': 5, 'step': 1});
                {% else %}
                    $('#main-section').hide();
                    $('#sign-in-lightbox').show();
                    $('#sign-up-stuff').show();
                    $('#signin-heading').text('Sign Up');
                    $('#type-signin').val('sign-up');
                    $('#sign-in-button').text('Sign Up');
                {% endif %}
            });
            $main.on('click', '#cancel-review-button', function () {
                $('#review_form').hide();
            });
            $main.on('click', '#review-submit', function () {
                var url = $(this).data('url');
                $.post(url, {'comment': $('#review-comment').val(), 'rating': $('#review-rating').val(),
                    'csrfmiddlewaretoken': $($('input[name="csrfmiddlewaretoken"]')[0]).val()}, function (data) {
                    var $owls = $('.owl-item');
                    var $items = $owls.find('.item');
                    if ($owls.length == 0) {
                        $('.owl-wrapper').append('<div class="owl-item" style="width: 610px;">' + data + '</div>');
                    } else {
                        if ($items.length % 2 == 1) {
                            $($owls[$owls.length - 1]).append(data);
                        } else {
                            $('.owl-wrapper').append('<div class="owl-item" style="width: 610px;">' + data + '</div>');
                        }
                    }
                    $('#review_form').remove();
                    $('#review-button').remove();
                    $('#reviews-box').show();
                });
            });
        });
    </script>
{% endblock %}