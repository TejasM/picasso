{% extends 'main_template.html' %}
{% load staticfiles %}
{% block content %}
    <!-- Revolution Slider -->
    <section class="revolution-slider">
        <div class="bannercontainer">
            <div class="banner">
                <ul>
                    <!-- Slide 1 -->
                    <li data-transition="fade" data-slotamount="7" data-masterspeed="1500">
                        <!-- Main Image -->
                        <img src="{% static 'images/slides/1700x449.gif' %}" style="opacity:0;" alt="slidebg1"
                             data-bgfit="cover"
                             data-bgposition="left bottom" data-bgrepeat="no-repeat">
                        <!-- Layers -->
                        <!-- Layer 1 -->
                        <div class="caption sft revolution-starhotel bigtext"
                             data-x="505"
                             data-y="30"
                             data-speed="700"
                             data-start="1700"
                             data-easing="easeOutBack">
                        <span><i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span> Best Piano Teachers <span><i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span></div>
                        <!-- Layer 2 -->
                        <div class="caption sft revolution-starhotel smalltext"
                             data-x="605"
                             data-y="105"
                             data-speed="800"
                             data-start="1700"
                             data-easing="easeOutBack">
                            <span>And we like to keep it that way!</span></div>
                        <!-- Layer 3 -->
                        <div class="caption sft"
                             data-x="775"
                             data-y="175"
                             data-speed="1000"
                             data-start="1900"
                             data-easing="easeOutBack">
                            <a href="#" class="button btn btn-purple btn-lg">See More Teachers</a>
                        </div>
                    </li>
                    <!-- Slide 2 -->
                    <li data-transition="boxfade" data-slotamount="7" data-masterspeed="1000">
                        <!-- Main Image -->
                        <img src="{% static 'images/slides/1700x449.gif' %}" alt="darkblurbg" data-bgfit="cover"
                             data-bgposition="left top"
                             data-bgrepeat="no-repeat">
                        <!-- Layers -->
                        <!-- Layer 1 -->
                        <div class="caption sft revolution-starhotel bigtext"
                             data-x="585"
                             data-y="30"
                             data-speed="700"
                             data-start="1700"
                             data-easing="easeOutBack">
                        <span><i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span> Top Mandarin
                            Tutor <span><i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i
                                class="fa fa-star-o"></i> <i class="fa fa-star-o"></i></span></div>
                        <!-- Layer 2 -->
                        <div class="caption sft revolution-starhotel smalltext"
                             data-x="682"
                             data-y="105"
                             data-speed="800"
                             data-start="1700"
                             data-easing="easeOutBack">
                            <span></span></div>
                        <!-- Layer 3 -->
                        <div class="caption sft"
                             data-x="785"
                             data-y="175"
                             data-speed="1000"
                             data-start="1900"
                             data-easing="easeOutBack">
                            <a href="#" class="button btn btn-purple btn-lg">See Details</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Reservation form -->
    <section id="reservation-form">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <form class="form-inline reservation-horizontal clearfix" role="form" method="post"
                          action="" name="reservationform" id="reservationform" onsubmit="javascript:void (0);">
                        <div id="message"></div>
                        <!-- Error message display -->
                        <div class="row">
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <h1 style="float: right; font-size: 2em">I am looking for a:</h1>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <input type="text" name="search" id="search-text" placeholder="Piano Teacher"
                                           class="form-control" style="font-size: 36px; height: 100%">
                                </div>
                            </div>
                            <div class="col-sm-1">
                                <div class="form-group">
                                    <h1 style="float: right; font-size: 2em">Near:</h1>
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <div class="form-group">
                                    <input type="text" name="location" id="location-text" value="Toronto"
                                           class="form-control" style="font-size: 36px; height: 100%">
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-primary btn-block" id="search-submisson">Search Now
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <div id="main-section">

    </div>

    <div id="sign-in-lightbox" style="display: none">
        <div class="container">
            <div class="row mt50">
                <div class="col-sm-12">
                    <h2 class="lined-heading"><span id="signin-heading">Sign Up</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <form class="clearfix" role="form" method="post" action="{% url 'main:signup' %}"
                          id="signupform" onsubmit="javascript:void(0)">
                        {% csrf_token %}
                        <input type="hidden" value="sign-up" id="type-signin" name="type">

                        <div class="row" id="sign-up-stuff">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="first-name" accesskey="U"><span class="required">*</span>First
                                        Name</label>
                                    <input name="first-name" type="text" id="first-name" class="form-control" value="">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="last-name" accesskey="E"><span class="required">*</span>Last
                                        Name</label>
                                    <input name="last-name" type="text" id="last-name" value="" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email" accesskey="S"><span class="required">*</span>Email</label>
                            <input name="email" id="email" class="form-control" type="email">
                        </div>
                        <div class="form-group">
                            <label for="password" accesskey="S"><span class="required">*</span>Password</label>
                            <input name="password" id="password" class="form-control" type="password">
                        </div>
                        <div class="error_message">

                        </div>
                        <button type="button" class="btn  btn-lg btn-primary" id="sign-in-button">Sign Up</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        $(function () {
            var $main = $('#main-section');
            $.get('{% url 'main:featured' %}', function (data) {
                $main.append(data);
                loadFilters();
            });
            $('#search-submisson').click(function (e) {
                $.get('{% url 'main:get_listings' %}', {'term': $('#search-text').val() + ' ' + $('#location-text').val()}, function (data) {
                    $('.revolution-slider').hide();
                    $main.empty();
                    $main.append(data);
                });
                return false;
            });

            $main.on('click', '.detail-back', function () {
                $('.revolution-slider').hide();
                $main.find('> div:last-child').remove();
                $main.find('> section').show();
            });

            $('#sign-up').click(function () {
                $('#main-section').hide();
                $('#sign-in-lightbox').show();
                $('#sign-up-stuff').show();
                $('#type-signin').val('sign-up');
                $('#signin-heading').text('Sign Up');
                $('#sign-in-button').text('Sign Up');
            });

            $('#login').click(function () {
                $('#main-section').hide();
                $('#sign-in-lightbox').show();
                $('#sign-up-stuff').hide();
                $('#type-signin').val('login');
                $('#signin-heading').text('Login');
                $('#sign-in-button').text('Login');
            });

            $('#sign-in-button').click(function () {
                $.post('{% url 'main:signup' %}', {'first-name': $('#first-name').val(),
                    'last-name': $('#last-name').val(), 'type': $('#type-signin').val(),
                    'email': $('#email').val(), 'password': $('#password').val(),
                    'csrfmiddlewaretoken': $($('input[name="csrfmiddlewaretoken"]')[0]).val()}, function (data) {
                    if (parseInt(data['success']) == 0) {
                        $('.error_message').text(data['error']);
                    } else {
                        document.location.href = '/';
                    }
                });
            });

            $main.on('click', '#review-button', function () {
                {% if user.is_authenticated %}
                    $('#review_form').show();
                    $("#review-rating").rating({'min': 0, 'max': 5, 'step': 1});
                {% else %}
                    $('#main-section').hide();
                    $('#sign-in-lightbox').show();
                    $('#sign-up-stuff').show();
                    $('#signin-heading').text('Sign Up');
                    $('#type-signin').val('sign-up');
                    $('#sign-in-button').text('Sign Up');
                {% endif %}
            });
            $main.on('click', '#cancel-review-button', function () {
                $('#review_form').hide();
            });
            $main.on('click', '#review-submit', function () {
                var url = $(this).data('url');
                $.post(url, {'comment': $('#review-comment').val(), 'rating': $('#review-rating').val(),
                    'csrfmiddlewaretoken': $($('input[name="csrfmiddlewaretoken"]')[0]).val()}, function (data) {
                    var $owls = $('.owl-item');
                    var $items = $owls.find('.item');
                    if ($owls.length == 0) {
                        $('.owl-wrapper').append('<div class="owl-item" style="width: 610px;">' + data + '</div>');
                    } else {
                        if ($items.length % 2 == 1) {
                            $($owls[$owls.length - 1]).append(data);
                        } else {
                            $('.owl-wrapper').append('<div class="owl-item" style="width: 610px;">' + data + '</div>');
                        }
                    }
                    $('#review_form').remove();
                    $('#review-button').remove();
                    $('#reviews-box').show();
                });
            });
        });
    </script>
{% endblock %}