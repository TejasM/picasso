{% load staticfiles %}
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    {% block seo %}
        <title>Picasso: Reviews and Recommendations of Extracurricular Classes and Teachers, Tutors, and Instructors in
            Toronto</title>
        <meta name="description"
              content="Reviews and recommendations of top classes, teachers, tutors, and instructors in Toronto. Looking for a music or art teacher? A language class? A martial arts instructor? Picasso has it all and more.">
    {% endblock %}
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/prettyPhoto.css' %}">
    <link rel="stylesheet" href="{% static 'css/smoothness/jquery-ui-1.10.4.custom.min.css' %}">
    <link rel="stylesheet" href="{% static 'rs-plugin/css/settings.css' %}">
    <link rel="stylesheet" href="{% static 'css/theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/colors/turquoise.css' %}">
    <link href="{% static 'css/line/blue.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600,700">
    <script type="text/javascript" src="{% static 'js/jquery-1.11.0.min.js' %}"></script>
    <link href="{% static 'css/star-rating.min.css' %}" media="all" rel="stylesheet" type="text/css"/>
    <link href="{% static 'css/bootstrap-switch.min.css' %}" media="all" rel="stylesheet" type="text/css"/>
    {% block additionalStyles %}
    {% endblock %}
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-52248102-1', 'findpicasso.com');
        ga('require', 'displayfeatures');
        ga('send', 'pageview');

    </script>
</head>
<body>
<!-- Header -->
<header style="border: none;">
    <!-- Navigation -->
    <div class="navbar yamm navbar-default" id="sticky">
        <div class="container">
            <div class="navbar-header">
                <button type="button" data-toggle="collapse" data-target="#navbar-collapse-grid" class="navbar-toggle">
                    <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
                </button>
                <a href="/" class="navbar-brand">
                    <!-- Logo -->
                    <div id="logo"><img id="default-logo" src="{% static 'images/logo.png' %}" alt="Picasso"
                                        style="height:44px;">
                        <img id="retina-logo" src="{% static 'images/logo.png' %}" alt="Picasso"
                             style="height:44px;"></div>
                </a></div>
            <div id="navbar-collapse-grid" class="navbar-collapse collapse">
                <ul class="nav navbar-nav" style="right: 0; position: absolute;">
                    <li class="active"><a href="/">Home</a>
                    </li>
                    {% if not user.is_authenticated %}
                        <li><a href="#sign-in-lightbox" id="sign-up">Sign Up</a></li>
                        <li><a href="#sign-in-lightbox" id="login">Login</a></li>
                    {% else %}
                        <li class=""><a href="{% url 'profile:profile' %}">Profile</a>
                        </li>
                        <li class=""><a href="{% url 'logout' %}">Logout</a>
                        </li>
                    {% endif %}
                    <li class=""><a href="#main-section" id="add-list">
                        <button type="button" style="margin-top: -5px" class="btn btn-primary btn-block">&nbsp;&nbsp;Add
                            Listing&nbsp;&nbsp;</button>
                    </a>
                    </li>
                    {% block search_block %}
                    {% endblock %}
                </ul>
            </div>
            {% block additional_search %}
            {% endblock %}
        </div>
    </div>
</header>
{% block above_content %}
{% endblock %}
<!-- Reservation form -->
{% block res_form %}
    <section id="reservation-form">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1 style="margin: 10px 0 20px;">Find the best {% block category %}extracurricular{% endblock %}
                        teachers around you.</h1>

                    <h2 style="margin-bottom: 20px">Search from over {{ number_of_listings }} classes and teachers in
                        Toronto,
                        Ontario.</h2>

                    <form class="form-inline reservation-horizontal clearfix" role="form" method="post"
                          action="" name="reservationform" id="reservationform" onsubmit="javascript:void (0);"
                          style="padding: 10px 10px">
                        <div id="message"></div>
                        <!-- Error message display -->
                        <div class="row row-xs-height">
                            <div class="col-lg-6 col-sm-12 col-lg-height">
                                <div class="form-group" style=" width: 100%">
                                    <i class="fa fa-2x fa-search"
                                       style="position: absolute; top: 10px; left: 25px; z-index: 1000;"></i>
                                    <input type="text" name="search" id="search-text"
                                           placeholder="What are you looking for?" class="form-control autocomplete"
                                           style="font-size: 25px; height: 100%; padding-left: 55px; width: 100%">
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-12 col-lg-height">
                                <div class="form-group">
                                    <i class="fa fa-2x fa-map-marker"
                                       style="position: absolute; top: 12px; left: 30px; z-index: 1000;"></i>
                                    <input type="text" name="location" id="location-text" value="Toronto" onblur="if (this.value == '')
                            this.value = this.defaultValue" onfocus="if (this.value == this.defaultValue)
                            this.value = ''" class="form-control" style="font-size: 25px; height: 100%;
                            padding-left: 40px">
                                </div>
                            </div>
                            <div class="col-lg-2 col-sm-12 col-lg-height">
                                <button type="button" class="btn btn-primary btn-block" id="search-submisson"
                                        style="margin-top: 0; height: 45px">Search Now
                                </button>
                            </div>
                        </div>
                    </form>

                    <h3 style="margin-bottom: 20px; color:white">Submit a review for a class or instructor by August 10
                        for a chance
                        to win an <b>iPad Mini</b>!
                        Each review is an eligible ballot.
                    </h3>

                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block messages %}
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-lg-offset-3 col-sm-12" id="messages">

            </div>
        </div>
    </div>
{% endblock %}
<div id="main-section">
    {% block content %}
    {% endblock %}
</div>
{% if not user.is_authenticated %}
    <div id="sign-in-choice-lightbox" style="display: none">
        <div class="container">
            <div class="row mt50" style="text-align: center">
                <div class="col-lg-4 col-lg-offset-4 col-sm-12">
                    <a href="#sign-in-lightbox" id="start-signup">
                        <button class="btn btn-lg btn-primary">Sign Up</button>
                    </a>
                    <h5 class="lined-heading mt50"><span>OR</span></h5>
                    <a href="#sign-in-lightbox" id="start-login">
                        <button class="btn btn-lg btn-primary">Login</button>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div id="sign-in-lightbox" style="display: none">
        <div class="container">
            <div class="row mt50">
                <div class="col-sm-12">
                    <h2 class="lined-heading"><span id="signin-heading">Sign Up</span></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <a href="{% url 'social:begin' 'facebook' %}?next={{ request.get_full_path }}"
                       class="btn btn-primary btn-block" id="facebook-heading">
                        Sign Up with Facebook
                    </a>

                    <h3 class="lined-heading" style="margin-top: 20px; margin-bottom: 20px"><span id="">OR</span></h3>

                    <form class="clearfix" role="form" method="post" action="{% url 'signup' %}"
                          id="signupform" onsubmit="javascript:void(0)">
                        {% csrf_token %}
                        <input type="hidden" value="sign-up" id="type-signin" name="type">

                        <div class="row" id="sign-up-stuff">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="first-name" accesskey="U"><span class="required">*</span>First
                                        Name</label>
                                    <input name="first-name" type="text" id="first-name" class="form-control" value="">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="last-name" accesskey="E"><span class="required">*</span>Last
                                        Name</label>
                                    <input name="last-name" type="text" id="last-name" value="" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email" accesskey="S"><span class="required">*</span>Email</label>
                            <input name="email" id="email" class="form-control" type="email">
                        </div>
                        <div class="form-group">
                            <label for="password" accesskey="S"><span class="required">*</span>Password</label>
                            <input name="password" id="password" class="form-control" type="password">
                        </div>
                        <input type="hidden" id="next-url" value="{{ request.get_full_path }}">

                        <div class="error_message">

                        </div>
                        <button type="button" class="btn  btn-lg btn-primary" id="sign-in-button">Sign Up</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endif %}
<div id="contact-us-div" style="display: none">
    <div class="container">
        <div class="row mt50">
            <div class="col-md-12">
                <h2 class="lined-heading"><span>Send us a message</span></h2>

                <div id="message"></div>
                <!-- Error message display -->
                <form class="clearfix mt50" role="form" method="post" action="#" name="contactform"
                      onsubmit="return false;"
                      id="contactform">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="contact-email" accesskey="E"><span class="required">*</span> E-mail</label>
                                <input name="email" type="text" id="contact-email" value="" class="form-control"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="contact-comments" accesskey="C"><span class="required">*</span> Your message</label>
                        <textarea name="comments" rows="9" id="contact-comments" class="form-control"></textarea>
                    </div>
                    <button type="button" class="btn  btn-lg btn-primary" id="contact-us-submit">Send message</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Footer -->
<footer style="margin-top: 20px;">
    <div class="container">
        <div class="row">
            <div class="col-md-3 col-sm-3">
                <h4><a href="{% url 'about' %}">About Picasso</a></h4>
                <h4><a href="{% url 'content' %}">Content Guidelines</a></h4>
            </div>
            <div class="col-md-6 col-sm-6" style="text-align: center">
                <a href="https://www.facebook.com/findpicasso.co" style="font-size: 50px; margin-right: 20px"><i
                        class="fa fa-facebook"></i></a>
                <a href="https://twitter.com/FindPicasso" style="font-size: 50px; margin-right: 20px"><i
                        class="fa fa-twitter"></i></a>
                <a href="https://plus.google.com/+FindpicassoNow"
                   style="font-size: 50px; margin-right: 20px"><i class="fa fa-google-plus"></i></a>
                <a href="https://www.linkedin.com/company/5270366"
                   style="font-size: 50px"><i class="fa fa-linkedin"></i></a>
            </div>
            <div class="col-md-3 col-sm-3">
                <h4><a href="{% url 'privacy' %}">Privacy Policy</a></h4>
                <h4><a href="{% url 'terms' %}">Terms of Agreement</a></h4>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-xs-6"> &copy; 2014 Picasso All Rights Reserved</div>
                <div class="col-xs-6 text-right">
                    <ul>
                        <li><a href="#contact-us-div" id="contact-us-click">Contact</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
</body>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="{% static 'css/chosen.min.css' %}">
<script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/bootstrap-hover-dropdown.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/owl.carousel.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.parallax-1.1.3.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.nicescroll.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.prettyPhoto.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery-ui-1.10.4.custom.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.jigowatt.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.sticky.js' %}"></script>
<script type="text/javascript" src="{% static 'js/waypoints.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.isotope.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.gmap.min.js' %}"></script>
<script type="text/javascript" src="{% static 'rs-plugin/js/jquery.themepunch.plugins.min.js' %}"></script>
<script type="text/javascript" src="{% static 'rs-plugin/js/jquery.themepunch.revolution.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/custom.js' %}"></script>
<script type="text/javascript" src="{% static 'js/star-rating.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/bootstrap-switch.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/typehead.js' %}"></script>
<script type="text/javascript" src="{% static 'js/icheck.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/bloodhound.js' %}"></script>
<script src="{% static 'js/chosen.jquery.min.js' %}"></script>
<script src="//code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
<script src="{% static 'js/jquery.history.js' %}"></script>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<script>
function initialize() {
    var mapOptions = {
        zoom: 10,
        center: new google.maps.LatLng(43.7, -79.4)
    };

    map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
            initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            map.setCenter(initialLocation);
        });
    }

    for (var i = 0; i < lats.length; i++) {
        var marker = new google.maps.Marker({
            map: map,
            position: new google.maps.LatLng(lats[i], lons[i]),
            title: names[i],
            visible: true,
            icon: 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + (i + 1).toString() + '|FF0000|000000'
        });
        markers.push(marker);
    }
}


History.Adapter.bind(window, 'statechange', function () { // Note: We are using statechange instead of popstate
    var State = History.getState(); // Note: We are using History.getState() instead of event.state
});

function loadScript() {
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&' +
            'callback=initialize';
    document.body.appendChild(script);
    script_loaded = true;
}
var map;
var lats = [];
var lons = [];
var names = [];
var markers = [];
var geocoder = null;
var script_loaded = false;
var tags = {{ all_tags|safe }};
function search(e) {
    $main.empty();
    $main.append('<div class="container mt50" style="text-align: center; margin-bottom: 50px"><img src="{% static 'images/ui/AjaxLoader.gif' %}" alt="loading"></div>');
    last_data = {'term': $('#search-text').val() + '----' + $('#location-text').val()};
    actual_search(last_data);
    return false;
}

function custom_search(page_number, term, options) {
    $main.empty();
    $main.append('<div class="container mt50" style="text-align: center; margin-bottom: 50px"><img src="{% static 'images/ui/AjaxLoader.gif' %}" alt="loading"></div>');
    last_data['term'] = term;
    last_data['page'] = page_number;
    if (options && options != null) {
        $.extend(last_data, options);
    }
    actual_search(last_data);
    return false;
}

var state_number = 1;

function actual_search(data) {
    $.get('{% url 'get_listings' %}', last_data, function (data) {
        $main.empty();
        $main.append(data['html']);
        lons = $.parseJSON(data['lons']);
        lats = $.parseJSON(data['lats']);
        names = data['names'];
        if (!script_loaded) {
            loadScript();
        } else {
            initialize();
        }
        $('input[type=checkbox], input[type=radio]').each(function () {
            var self = $(this),
                    label = self.next(),
                    label_text = label.text();

            label.remove();
            self.iCheck({
                checkboxClass: 'icheckbox_line-blue',
                radioClass: 'iradio_line-blue',
                insert: '<div class="icheck_line-icon"></div>' + label_text
            });
        });
        $(".rating").rating({'min': 0, 'max': 5, 'step': 0.5, size: 'xs', showCaption: false, showClear: false});
        History.pushState({state: state_number}, "State " + state_number.toString(), "?state=" + state_number.toString());
        state_number++;
    });
}

function add_listing() {
    $.get('{% url 'profile:add_listing' %}', function (data) {
        $('#create-listing-div').remove();
        if (typeof $my_listings !== 'undefined') {
            $my_listings.hide();
            $main.append(data);
        } else {
            $main.hide();
            $main.after(data);
        }
        $("#are-owner").bootstrapSwitch({onText: 'YES', offText: 'NO'});
        $("#are-active").bootstrapSwitch({onText: 'YES', offText: 'NO'});
        $('#listing-level').chosen({width: '200px'});
        var $range = $("#slider-range");
        var values = [ 10, 100];
        $range.slider({
            range: true,
            min: 0,
            max: 500,
            values: values,
            slide: function (event, ui) {
                $("#listing-price").val("$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ]);
            }
        });
        $("#listing-price").val("$" + $range.slider("values", 0) +
                " - $" + $range.slider("values", 1));
        $('#listing-categories').bind("keydown", function (event) {
            if (event.keyCode === $.ui.keyCode.TAB &&
                    $(this).autocomplete("instance").menu.active) {
                event.preventDefault();
            }
        })
                .autocomplete({
                    minLength: 0,
                    source: function (request, response) {
                        // delegate back to autocomplete, but extract the last term
                        response($.ui.autocomplete.filter(
                                tags, extractLast(request.term)));
                    },
                    focus: function () {
                        // prevent value inserted on focus
                        return false;
                    },
                    select: function (event, ui) {
                        var terms = split(this.value);
                        // remove the current input
                        terms.pop();
                        // add the selected item
                        terms.push(ui.item.value);
                        // add placeholder to get the comma-and-space at the end
                        terms.push("");
                        this.value = terms.join(", ");
                        return false;
                    }
                });
    });
}
var last_data;
var $main = $('#main-section');
var scrolled = false;
$(function () {
            $('#search-submisson').click(search);

            $('#search-text').bind('keypress', function (e) {
                var code = e.keyCode || e.which;
                if (code == 13) {
                    $('#search-submisson').trigger('click');
                }
            });

            $('#location-text').bind('keypress', function (e) {
                var code = e.keyCode || e.which;
                if (code == 13) {
                    $('#search-submisson').trigger('click');
                }
            });

            {% if not user.is_authenticated %}
                $('#sign-up').click(function () {
                    $('#create-listing-div').remove();

                    $('#main-section').hide();
                    $('#sign-in-lightbox').show();
                    $('#sign-up-stuff').show();
                    $('#type-signin').val('sign-up');
                    $('#facebook-heading').text('Sign Up with Facebook');
                    $('#signin-heading').text('Sign Up');
                    $('#sign-in-button').text('Sign Up');
                });

                $('#login').click(function () {
                    $('#create-listing-div').remove();
                    $('#main-section').hide();
                    $('#sign-in-lightbox').show();
                    $('#sign-up-stuff').hide();
                    $('#type-signin').val('login');
                    $('#facebook-heading').text('Login with Facebook');
                    $('#signin-heading').text('Login');
                    $('#sign-in-button').text('Login');
                });
                $('#sign-in-button').click(function () {
                    $('#create-listing-div').remove();
                    var claim_id = $('input[name="claim-id"]').val() || '';
                    $.post('{% url 'signup' %}', {'first-name': $('#first-name').val(),
                        'last-name': $('#last-name').val(), 'type': $('#type-signin').val(),
                        'email': $('#email').val(), 'password': $('#password').val(),
                        'claim-id': claim_id,
                        'csrfmiddlewaretoken': $($('input[name="csrfmiddlewaretoken"]')[0]).val()}, function (data) {
                        if (parseInt(data['success']) == 0) {
                            $('.error_message').text(data['error']);
                        } else {
                            var $next = $('#next-url');
                            if ($next.length != 0) {
                                document.location.href = $next.val();
                            }
                            document.location.href = '{{ request.get_full_path }}';
                        }
                    });
                });
            {% endif %}
            // constructs the suggestion engine
            var tags_blood = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                // `states` is an array of state names defined in "The Basics"
                local: $.map(tags, function (state) {
                    return { value: state };
                })
            });
            tags_blood.initialize();

            $('.autocomplete').typeahead({
                        hint: true,
                        highlight: true,
                        minLength: 1
                    },
                    {
                        name: 'tags',
                        displayKey: 'value',
                        source: tags_blood.ttAdapter()
                    });
            var $contact_div = $('#contact-us-div');
            $('#contact-us-click').click(function () {
                $main.hide();
                $contact_div.show();
            });
            $('#contact-us-submit').click(function () {
                $.post('{% url 'contact' %}', {'csrfmiddlewaretoken': $($('input[name="csrfmiddlewaretoken"]')[0]).val(),
                    'email': $('#contact-email').val(), 'comment': $('#contact-comments').val()
                }, function (res) {
                    $contact_div.empty();
                    $contact_div.append('<div class="container mt20" style="text-align: center"><h2>Thank you for your message! We will try and get back to you as soon as possible.</h2></div>');
                    setTimeout(function () {
                        $contact_div.hide();
                        $main.show();
                    }, 5000);
                });
            });

            $(window).scroll(function () {
                var $map = $('#map-cover');
                var locMin = 0;
                var locMax = $('.isotope').height() - $map.height();
                var dif = $(window).height() / 2 - $map.height() / 2;
                var loc = dif + $(window).scrollTop() - $map.parent().offset().top;
                if (loc > locMax)
                    loc = locMax;
                if (loc < locMin)
                    loc = locMin;
                $map.css('top', loc);
            });

            $main.on('ifToggled', '.loe-check', function () {
                var $checked = $('.loe-check:checked');
                var $items = $('.isotope-item');
                if ($checked.length == 0) {
                    $('.loe-check').iCheck('check');
                    $checked = $('.loe-check:checked');
                }
                if ($checked.length == 3) {
                    $items.show();
                } else {
                    $.each($items, function (index) {
                        var $teach = $(this).find('.teaches');
                        var t = $teach.text();
                        if (t == "All") {
                            $(this).show();
                        } else {
                            var done = false;
                            for (var i = 0; i < $checked.length; i++) {
                                if (t.indexOf($checked[i].val()) > -1) {
                                    $(this).show();
                                    done = true;
                                    break;
                                }
                            }
                            if (!done) {
                                $(this).hide();
                            }
                        }
                    });
                }
            });
            $main.on('ifChecked', 'input[name="review-radio"]', function () {
                var val = $(this).val();
                var $items = $('.isotope-item');
                if (val == -1) {
                    $items.show();
                } else {
                    $.each($items, function (index) {
                        var $r = $(this).find('.review');
                        var r = parseInt($r.text());
                        if (!isNaN(r)) {
                            if (r < val) {
                                $(this).hide();
                            } else {
                                $(this).show();
                            }
                        } else {
                            $(this).hide();
                        }
                    });
                }
            });

            $main.on('mouseenter', '.isotope-item', function () {
                var i = $('.isotope-item').index($(this));
                markers[i].setIcon('http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + (i + 1).toString() + '|74A7D5|000000');
                map.setCenter(markers[i].position);
            });

            $main.on('mouseleave', '.isotope-item', function () {
                var i = $('.isotope-item').index($(this));
                markers[i].setIcon('http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=' + (i + 1).toString() + '|FF0000|000000');
            });
            $main.on('click', '.add-list', add_listing);
            $('#add-list').click(add_listing);

            $('body').on('click', '#submit-create-listing', function () {
                var url = $(this).data('url');
                var $range = $("#slider-range");
                $.post(url, {'listing_name': $('#listing-name').val(), 'place_name': $('#place-name').val(),
                            'class_name': $('#class-name').val(),
                            'description': $('#listing-description').val(),
                            'address': $('#listing-address').val(), 'postal': $('#listing-postal').val(),
                            'city': $('#listing-city').val(), 'country': $('#listing-country').val(),
                            'phone': $('#listing-phone').val(), 'owner': $('#are-owner').is(':checked'),
                            'active': $('#are-active').is(':checked'),
                            'price_min': $range.slider("values", 0), 'price_max': $range.slider("values", 1),
                            'level_of_expertise[]': $('#listing-level').val() || [],
                            'categories': $('#listing-categories').val(), 'email': $('#listing-email').val(),
                            'website': $('#listing-website').val(),
                            'csrfmiddlewaretoken': $($('input[name="csrfmiddlewaretoken"]')[0]).val()},
                        function (data) {
                            $('#create-listing-div').remove();
                            window.location.href = data['url'];
                        });
            });
        }
)
;
function split(val) {
    return val.split(/,\s*/);
}

function extractLast(term) {
    return split(term).pop();
}
</script>
{% block scripts %}

{% endblock %}
</html>